<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interface to ECMWF and CDS Data Web Services • ecmwfr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/all.min.css" integrity="sha256-PbSmjxuVAzJ6FPvNYsrXygfGhNJYyZ2GktDbkMBqQZg=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/v4-shims.min.css" integrity="sha256-A6jcAdwFD48VMjlI3GDxUd+eCQa7/KWy6G9oe/ovaPA=" crossorigin="anonymous">
<!-- Fonts --><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,300;0,400;0,700;1,300;1,400&amp;display=swap" rel="stylesheet">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><!-- ropensci --><link href="bglabs.css" rel="stylesheet">
<meta property="og:title" content="Interface to ECMWF and CDS Data Web Services">
<meta property="og:description" content="Programmatic interface to the European Centre for Medium-Range
    Weather Forecasts dataset web services (ECMWF; &lt;https://www.ecmwf.int/&gt;)
    and Copernicus's Climate Data Store (CDS; 
    &lt;https://cds.climate.copernicus.eu&gt;). Allows for easy downloads of weather 
    forecasts and climate reanalysis data in R.">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">

    <div class="navbar-header">

      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="external-link hidden-sm hidden-xs" href="https://bluegreenlabs.org">
          <img src="https://bluegreenlabs.org/img/logo_text_small.png" id="hexlogo" alt="bluegreen labs"></a>
        <a class="external-link hidden-md hidden-lg" href="https://bluegreenlabs.org">
          <img src="https://bluegreenlabs.org/img/logo.png" id="hexlogo" alt="bluegreen labs"></a>
        <a class="navbar-brand" href="index.html">
           <i>ecmwfr <small>v1.5.0</small></i>
        </a>
      </div>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/ads_vignette.html">ADS functionality</a>
    </li>
    <li>
      <a href="articles/advanced_vignette.html">Advanced Use Cases</a>
    </li>
    <li>
      <a href="articles/cds_vignette.html">CDS functionality</a>
    </li>
    <li>
      <a href="articles/cds_workflow_vignette.html">CDS workflow functionality</a>
    </li>
    <li>
      <a href="articles/webapi_vignette.html">WebAPI functionality</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/bluegreen-labs/ecmwfr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="ecmwfr-">ecmwfr <img src="reference/figures/logo.png" align="right" height="138.5"><a class="anchor" aria-label="anchor" href="#ecmwfr-"></a>
</h1></div>
<p><a href="https://github.com/bluegreen-labs/ecmwfr/actions" class="external-link"><img src="https://github.com/bluegreen-labs/ecmwfr/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a> <a href="https://codecov.io/gh/bluegreen-labs/ecmwfr" class="external-link"><img src="https://codecov.io/gh/bluegreen-labs/ecmwfr/branch/master/graph/badge.svg" alt="codecov"></a> <a href="https://cran.r-project.org/package=ecmwfr" class="external-link"><img src="https://www.r-pkg.org/badges/version/ecmwfr" alt="CRAN_Status_Badge"></a> <a href="https://www.repostatus.org/#active" class="external-link"><img src="https://www.repostatus.org/badges/latest/active.svg" alt="Project Status: Active – The project has reached a stable, usable state and is being actively developed."></a> <a href="https://cran.r-project.org/package=ecmwfr" class="external-link"><img src="https://cranlogs.r-pkg.org/badges/grand-total/ecmwfr"></a> <a href="https://zenodo.org/badge/latestdoi/156325084" class="external-link"><img src="https://zenodo.org/badge/156325084.svg" alt="DOI"></a></p>
<p>Programmatic interface to the two <a href="https://www.ecmwf.int/" class="external-link">European Centre for Medium-Range Weather Forecasts</a> API services. The package provides easy access to the <a href="https://confluence.ecmwf.int/display/WEBAPI/ECMWF+Web+API+Home" class="external-link">‘ECMWF’ web API services</a> and Copernicus <a href="https://cds.climate.copernicus.eu" class="external-link">Climate Data Store</a> or ‘CDS’ from within R, matching and expanding upon the ECMWF python tools.</p>
<div class="section level2">
<h2 id="how-to-cite-this-package-in-your-article">How to cite this package in your article<a class="anchor" aria-label="anchor" href="#how-to-cite-this-package-in-your-article"></a>
</h2>
<p>You can cite this package like this “we obtained data from the European Centre for Medium-Range Weather Forecasts API using the ecmwf R package (Hufkens, Stauffer, and Campitelli 2019)”. Here is the full bibliographic reference to include in your reference list (don’t forget to update the ‘last accessed’ date):</p>
<blockquote>
<p>Hufkens, K., R. Stauffer, &amp; E. Campitelli. (2019). ecmwfr: Programmatic interface to the two European Centre for Medium-Range Weather Forecasts API services. Zenodo. <a href="http://doi.org/10.5281/zenodo.2647531" class="external-link uri">http://doi.org/10.5281/zenodo.2647531</a>.</p>
</blockquote>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="section level3">
<h3 id="stable-release">stable release<a class="anchor" aria-label="anchor" href="#stable-release"></a>
</h3>
<p>To install the current stable release use a CRAN repository:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"ecmwfr"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/bluegreen-labs/ecmwfr" class="external-link">"ecmwfr"</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="development-release">development release<a class="anchor" aria-label="anchor" href="#development-release"></a>
</h3>
<p>To install the development releases of the package run the following commands:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span><span class="op">}</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"bluegreen-labs/ecmwfr"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/bluegreen-labs/ecmwfr" class="external-link">"ecmwfr"</a></span><span class="op">)</span></span></code></pre></div>
<p>Vignettes are not rendered by default, if you want to include additional documentation please use:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span><span class="op">}</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"bluegreen-labs/ecmwfr"</span>, build_vignettes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/bluegreen-labs/ecmwfr" class="external-link">"ecmwfr"</a></span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="use-ecmwf-services">Use: ECMWF services<a class="anchor" aria-label="anchor" href="#use-ecmwf-services"></a>
</h2>
<p>Create a ECMWF account by <a href="https://accounts.ecmwf.int/auth/realms/ecmwf/protocol/openid-connect/registrations?client_id=apps&amp;response_type=code&amp;scope=openid%20email&amp;redirect_uri=https://www.ecmwf.int" class="external-link">self registering</a> and retrieving your key at <a href="https://api.ecmwf.int/v1/key/" class="external-link uri">https://api.ecmwf.int/v1/key/</a> after you log in. The key is a long series of numbers and characters (X in the example below).</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"url"</span>   <span class="fu">:</span> <span class="st">"https://api.ecmwf.int/v1"</span><span class="fu">,</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"key"</span>   <span class="fu">:</span> <span class="st">"XXXXXXXXXXXXXXXXXXXXXX"</span><span class="fu">,</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"email"</span> <span class="fu">:</span> <span class="st">"john.smith@example.com"</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<div class="section level3">
<h3 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h3>
<p>Before starting save the provided key to your local keychain. The package does not allow you to use your key inline in scripts to limit security issues when sharing scripts on github or otherwise.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set a key to the keychain</span></span>
<span><span class="fu"><a href="reference/wf_set_key.html">wf_set_key</a></span><span class="op">(</span>user <span class="op">=</span> <span class="st">"john.smith@example.com"</span>,</span>
<span>           key <span class="op">=</span> <span class="st">"XXXXXXXXXXXXXXXXXXXXXX"</span>,</span>
<span>           service <span class="op">=</span> <span class="st">"webapi"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># you can retrieve the key using</span></span>
<span><span class="fu"><a href="reference/wf_get_key.html">wf_get_key</a></span><span class="op">(</span>user <span class="op">=</span> <span class="st">"john.smith@example.com"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># the output should be the key you provided</span></span>
<span><span class="co"># "XXXXXXXXXXXXXXXXXXXXXX"</span></span>
<span></span>
<span><span class="co"># Alternatively you can input your login info with an interactive request</span></span>
<span><span class="fu"><a href="reference/wf_set_key.html">wf_set_key</a></span><span class="op">(</span>service <span class="op">=</span> <span class="st">"webapi"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># you will get a command line request to provide the required details</span></span></code></pre></div>
<p>Before you can download any data you have to make sure to accept the terms and conditions here: <a href="https://apps.ecmwf.int/datasets/licences/general/" class="external-link uri">https://apps.ecmwf.int/datasets/licences/general/</a>.</p>
</div>
<div class="section level3">
<h3 id="data-requests">Data Requests<a class="anchor" aria-label="anchor" href="#data-requests"></a>
</h3>
<p>To download data use the wf_request() function, together with your email and a request string syntax <a href="https://confluence.ecmwf.int/display/WEBAPI/Brief+request+syntax#Briefrequestsyntax-Syntax" class="external-link">as documented</a>. Instead of <code>json</code> formatting the function uses a simple <code>R</code> list for all the arguments. Be sure to specify which service to use, in this case <code>webapi</code> is the correct service to request data from.</p>
<p>The conversion from a MARS or python based query to the list format can be automated if you use the RStudio based Addin. By selecting and using Addin -&gt; Mars to list (or ‘Python to list’) you dynamically convert queries copied from either ECMWF or CDS/ADS based services.</p>
<p><img src="https://user-images.githubusercontent.com/1354258/56429601-ced94100-62c3-11e9-82f3-ae2cd03d06f5.gif"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># this is an example of a request</span></span>
<span><span class="va">my_request</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span> stream <span class="op">=</span> <span class="st">"oper"</span>,</span>
<span> levtype <span class="op">=</span> <span class="st">"sfc"</span>,</span>
<span> param <span class="op">=</span> <span class="st">"165.128/166.128/167.128"</span>,</span>
<span> dataset <span class="op">=</span> <span class="st">"interim"</span>,</span>
<span> step <span class="op">=</span> <span class="st">"0"</span>,</span>
<span> grid <span class="op">=</span> <span class="st">"0.75/0.75"</span>,</span>
<span> time <span class="op">=</span> <span class="st">"00/06/12/18"</span>,</span>
<span> date <span class="op">=</span> <span class="st">"2014-07-01/to/2014-07-31"</span>,</span>
<span> type <span class="op">=</span> <span class="st">"an"</span>,</span>
<span> class <span class="op">=</span> <span class="st">"ei"</span>,</span>
<span> area <span class="op">=</span> <span class="st">"73.5/-27/33/45"</span>,</span>
<span> format <span class="op">=</span> <span class="st">"netcdf"</span>,</span>
<span> target <span class="op">=</span> <span class="st">"tmp.nc"</span></span>
<span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># an example download using fw_request()</span></span>
<span><span class="co"># using the above request list()</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># data will be transferred to disk</span></span>
<span><span class="co"># and saved in your home directory (~)</span></span>
<span><span class="co"># set by the path argument</span></span>
<span></span>
<span><span class="fu"><a href="reference/wf_request.html">wf_request</a></span><span class="op">(</span></span>
<span>  user <span class="op">=</span> <span class="st">"khrdev@outlook.com"</span>,</span>
<span>  request <span class="op">=</span> <span class="va">my_request</span>,</span>
<span>  transfer <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  path <span class="op">=</span> <span class="st">"~"</span><span class="op">)</span></span></code></pre></div>
<p>This operation might take a while. A progress indicator will keep you informed on the status of your request. Keep in mind that all data downloaded will be buffered in memory limiting the downloads to ~6GB on low end systems. You can track ongoing jobs at in the joblist at: <a href="https://apps.ecmwf.int/webmars/joblist/" class="external-link uri">https://apps.ecmwf.int/webmars/joblist/</a>.</p>
</div>
</div>
<div class="section level2">
<h2 id="use-copernicus-climate-data-store-cds">Use: Copernicus Climate Data Store (CDS)<a class="anchor" aria-label="anchor" href="#use-copernicus-climate-data-store-cds"></a>
</h2>
<p>Create a free CDS user account by <a href="https://cds.climate.copernicus.eu/user/register" class="external-link">self registering</a>. Once your user account has been verified you can get your personal <em>user ID</em> and <em>key</em> by visiting the <a href="https://cds.climate.copernicus.eu/user" class="external-link">user profile</a>. This information is required to be able to retrieve data via the <code>ecmwfr</code> package. Use the <code>ecmwf</code> <a href="references/wf_set_key.html"><code>wf_set_key</code></a> function to store your login information in the system keyring (see below). Be aware, that unlike the API key for the ECMWF API your <code>user</code> does not correspond to the email address you use for the CDS login.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="er">UID:</span> <span class="er">1234</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="er">API</span> <span class="er">key:</span> <span class="er">abcd1234-foo-bar-98765431-XXXXXXXXXX</span></span></code></pre></div>
<div class="section level3">
<h3 id="setup-1">Setup<a class="anchor" aria-label="anchor" href="#setup-1"></a>
</h3>
<p>If you prefer to use your local keychain (rather than using the <code>.cdsapirc</code> file) you have to save your login information first. The package does not allow you to use your key inline in scripts to limit security issues when sharing scripts on github or otherwise.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set a key to the keychain</span></span>
<span><span class="fu"><a href="reference/wf_set_key.html">wf_set_key</a></span><span class="op">(</span>user <span class="op">=</span> <span class="st">"1234"</span>,</span>
<span>            key <span class="op">=</span> <span class="st">"abcd1234-foo-bar-98765431-XXXXXXXXXX"</span>,</span>
<span>            service <span class="op">=</span> <span class="st">"cds"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># you can retrieve the key using</span></span>
<span><span class="fu"><a href="reference/wf_get_key.html">wf_get_key</a></span><span class="op">(</span>user <span class="op">=</span> <span class="st">"1234"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># the output should be the key you provided</span></span>
<span><span class="co"># "abcd1234-foo-bar-98765431-XXXXXXXXXX"</span></span>
<span></span>
<span><span class="co"># Alternatively you can input your login info with an interactive request</span></span>
<span><span class="fu"><a href="reference/wf_set_key.html">wf_set_key</a></span><span class="op">(</span>service <span class="op">=</span> <span class="st">"cds"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># you will get a command line request to provide the required details</span></span></code></pre></div>
<p>Before you can download any data you have to make sure to accept the terms and conditions here: Before downloading and processing data from CDS please make sure you accept the terms and conditions which can be found here: <a href="https://cds.climate.copernicus.eu/disclaimer-privacy" class="external-link">Copernicus Climate Data Store Disclaimer/Privacy</a>.</p>
</div>
<div class="section level3">
<h3 id="data-requests-1">Data Requests<a class="anchor" aria-label="anchor" href="#data-requests-1"></a>
</h3>
<p>To download data use the <a href="references/wf_request.html"><code>wf_request</code></a> function, together with your <em>user ID</em> and a request string syntax <a href="https://confluence.ecmwf.int/display/WEBAPI/Brief+request+syntax#Briefrequestsyntax-Syntax" class="external-link">as documented</a>. Instead of <code>json</code> formatting the function uses a simple <code>R</code> list for all the arguments. Be sure to specify the service you want to use in your query in this case <code>cds</code>.</p>
<p><strong>Note</strong>: the simplest way to get the requests is to go to the CDS website which offers an interactive interface to create these requests. E.g., for ERA-5 reanalysis:</p>
<ul>
<li><a href="https://cds.climate.copernicus.eu/cdsapp#!/dataset/reanalysis-era5-pressure-levels?tab=form" class="external-link">pressure level data</a></li>
<li><a href="https://cds.climate.copernicus.eu/cdsapp#!/dataset/reanalysis-era5-single-levels?tab=form" class="external-link">surface data</a></li>
<li>…</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This is an example of a request for # downloading 'ERA-5' reanalysis data for</span></span>
<span><span class="co"># 2000-04-04 00:00 UTC, temperature on # 850 hectopascal for an area covering </span></span>
<span><span class="co"># northern Europe.</span></span>
<span><span class="co"># File will be stored as "era5-demo.nc" (netcdf format).</span></span>
<span><span class="va">request</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span> <span class="st">"dataset_short_name"</span> <span class="op">=</span> <span class="st">"reanalysis-era5-pressure-levels"</span>,</span>
<span> <span class="st">"product_type"</span> <span class="op">=</span> <span class="st">"reanalysis"</span>,</span>
<span> <span class="st">"variable"</span> <span class="op">=</span> <span class="st">"temperature"</span>,</span>
<span> <span class="st">"pressure_level"</span> <span class="op">=</span> <span class="st">"850"</span>,</span>
<span> <span class="st">"year"</span> <span class="op">=</span> <span class="st">"2000"</span>,</span>
<span> <span class="st">"month"</span> <span class="op">=</span> <span class="st">"04"</span>,</span>
<span> <span class="st">"day"</span> <span class="op">=</span> <span class="st">"04"</span>,</span>
<span> <span class="st">"time"</span> <span class="op">=</span> <span class="st">"00:00"</span>,</span>
<span> <span class="st">"area"</span> <span class="op">=</span> <span class="st">"70/-20/00/60"</span>,</span>
<span> <span class="st">"format"</span> <span class="op">=</span> <span class="st">"netcdf"</span>,</span>
<span> <span class="st">"target"</span> <span class="op">=</span> <span class="st">"era5-demo.nc"</span></span>
<span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># If you have stored your user login information</span></span>
<span><span class="co"># in the keyring by calling cds_set_key you can</span></span>
<span><span class="co"># call:</span></span>
<span><span class="va">file</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/wf_request.html">wf_request</a></span><span class="op">(</span></span>
<span> user     <span class="op">=</span> <span class="st">"1234"</span>,   <span class="co"># user ID (for authentification)</span></span>
<span> request  <span class="op">=</span> <span class="va">request</span>,  <span class="co"># the request</span></span>
<span> transfer <span class="op">=</span> <span class="cn">TRUE</span>,     <span class="co"># download the file</span></span>
<span> path     <span class="op">=</span> <span class="st">"."</span>       <span class="co"># store data in current working directory</span></span>
<span> <span class="op">)</span></span></code></pre></div>
<p>The CDS services are quite fast, however, if you request a lot of variables, multiple levels, and data over several years these requests might take quite a while! <strong>Note</strong>: If you need to download larger amounts of data it is suggested to split the downloads, e.g., download the data in chunks (e.g., month-by-month, or year-by-year). A progress indicator will keep you informed on the status of your request. Keep in mind that all data downloaded will be buffered in memory limiting the downloads to ~6GB on low end systems.</p>
</div>
<div class="section level3">
<h3 id="workflow-requests">Workflow requests<a class="anchor" aria-label="anchor" href="#workflow-requests"></a>
</h3>
<p>In addition to data requests the CDS API provides support for the execution of python scripts on the ECMWF servers using the CDS Toolbox. This server side processing allows you to aggregate data on the server, rather than having to download vast amounts of data to the client side before aggregation. Below we show an example of how to query data for a single location and product, aggregated to a daily time step. For examples and more advanced use we refer to the <a href="https://cds.climate.copernicus.eu/toolbox/doc/index.html" class="external-link">CDS Toolbox documentation</a>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="co"># basic request for data via python</span></span>
<span>  <span class="co"># note that indentation is important</span></span>
<span>  <span class="co"># in this context</span></span>
<span>  <span class="va">code</span> <span class="op">&lt;-</span><span class="st">"</span></span>
<span><span class="st">import cdstoolbox as ct</span></span>
<span><span class="st"></span></span>
<span><span class="st">@ct.application()</span></span>
<span><span class="st">@ct.output.download()</span></span>
<span><span class="st">def plot_time_series(var, lon, lat):</span></span>
<span><span class="st">    data = ct.catalogue.retrieve(</span></span>
<span><span class="st">      'reanalysis-era5-single-levels',</span></span>
<span><span class="st">      {</span></span>
<span><span class="st">        'variable': '2m_temperature',</span></span>
<span><span class="st">        'grid': ['3', '3'],</span></span>
<span><span class="st">        'product_type': 'reanalysis',</span></span>
<span><span class="st">        'year': ['2008'],</span></span>
<span><span class="st">        'month': ['01'],</span></span>
<span><span class="st">        'day': ['01'],</span></span>
<span><span class="st">        'time': ['00:00', '06:00', '12:00', '18:00'],</span></span>
<span><span class="st">      }</span></span>
<span><span class="st">    )</span></span>
<span><span class="st"></span></span>
<span><span class="st">    data_sel = ct.geo.extract_point(data, lon=lon, lat=lat)</span></span>
<span><span class="st">    data_daily = ct.climate.daily_mean(data_sel)</span></span>
<span><span class="st">    return data_daily</span></span>
<span><span class="st">"</span></span>
<span></span>
<span>  <span class="co"># Format the {ecmwfr} request</span></span>
<span>  <span class="co"># note that the workflow name must correspond</span></span>
<span>  <span class="co"># to the python script function name</span></span>
<span>  <span class="va">request</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    code <span class="op">=</span> <span class="va">code</span>,</span>
<span>    kwargs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      var <span class="op">=</span> <span class="st">"Near-Surface Air Temperature"</span>,</span>
<span>      lat <span class="op">=</span> <span class="fl">50</span>,</span>
<span>      lon <span class="op">=</span> <span class="fl">20</span></span>
<span>    <span class="op">)</span>,</span>
<span>    workflow_name <span class="op">=</span> <span class="st">"plot_time_series"</span>,</span>
<span>    target <span class="op">=</span> <span class="st">"test.nc"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Execute the script via the API</span></span>
<span>  <span class="co"># as you would for a data request</span></span>
<span>  <span class="fu"><a href="reference/wf_request.html">wf_request</a></span><span class="op">(</span></span>
<span>      <span class="va">request</span>,</span>
<span>      user <span class="op">=</span> <span class="st">"2088"</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="use-copernicus-atmosphere-data-store-ads">Use: Copernicus Atmosphere Data Store (ADS)<a class="anchor" aria-label="anchor" href="#use-copernicus-atmosphere-data-store-ads"></a>
</h2>
<p>Create a free ADS user account by <a href="https://ads.atmosphere.copernicus.eu/user/register" class="external-link">self registering</a>. Once your user account has been verified you can get your personal <em>user ID</em> and <em>key</em> by visiting the <a href="https://ads.atmosphere.copernicus.eu/user/" class="external-link">user profile</a>. This information is required to be able to retrieve data via the <code>ecmwfr</code> package. Use the <code>ecmwf</code> <a href="references/wf_set_key.html"><code>wf_set_key</code></a> function to store your login information in the system keyring (see below). Be aware, that unlike the API key for the ECMWF API your <code>user</code> does not correspond to the email address you use for the ADS login.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="er">UID:</span> <span class="er">2345</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="er">API</span> <span class="er">key:</span> <span class="er">asfed1234-foo-bar-98765431-XXXXXXXXXX</span></span></code></pre></div>
<div class="section level3">
<h3 id="setup-2">Setup<a class="anchor" aria-label="anchor" href="#setup-2"></a>
</h3>
<p>If you prefer to use your local keychain (rather than using the <code>.cdsapirc</code> file) you have to save your login information first. The package does not allow you to use your key inline in scripts to limit security issues when sharing scripts on github or otherwise.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set a key to the keychain</span></span>
<span><span class="fu"><a href="reference/wf_set_key.html">wf_set_key</a></span><span class="op">(</span>user <span class="op">=</span> <span class="st">"2345"</span>,</span>
<span>            key <span class="op">=</span> <span class="st">"asfed1234-foo-bar-98765431-XXXXXXXXXX"</span>,</span>
<span>            service <span class="op">=</span> <span class="st">"cds"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># you can retrieve the key using</span></span>
<span><span class="fu"><a href="reference/wf_get_key.html">wf_get_key</a></span><span class="op">(</span>user <span class="op">=</span> <span class="st">"2345"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># the output should be the key you provided</span></span>
<span><span class="co"># "asfed1234-foo-bar-98765431-XXXXXXXXXX"</span></span>
<span></span>
<span><span class="co"># Alternatively you can input your login info with an interactive request</span></span>
<span><span class="fu"><a href="reference/wf_set_key.html">wf_set_key</a></span><span class="op">(</span>service <span class="op">=</span> <span class="st">"ads"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># you will get a command line request to provide the required details</span></span></code></pre></div>
<p>Before you can download any data you have to make sure to accept the terms and conditions here: Before downloading and processing data from CDS please make sure you accept the terms and conditions which can be found here: <a href="https://ads.atmosphere.copernicus.eu/disclaimer-privacy" class="external-link">Copernicus Atmosphere Data Store Disclaimer/Privacy</a>.</p>
</div>
<div class="section level3">
<h3 id="data-requests-2">Data Requests<a class="anchor" aria-label="anchor" href="#data-requests-2"></a>
</h3>
<p>To download data use the <a href="references/wf_request.html"><code>wf_request</code></a> function, together with your <em>user ID</em> and a request string syntax. Instead of <code>json</code> formatting the function uses a simple <code>R</code> list for all the arguments. Be sure to specify the service you want to use in your query in this case <code>ads</code>. Note that the <code>cds</code> and <code>ads</code> services are identical in use except for their login credentials</p>
<p><strong>Note</strong>: the simplest way to get the requests is to go to the ADS website which offers an interactive interface to create these requests. E.g., for air quality data:</p>
<ul>
<li><a href="https://ads.atmosphere.copernicus.eu/cdsapp#!/dataset/cams-europe-air-quality-forecasts?tab=form" class="external-link">European air quality data</a></li>
<li>…</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This is an example of a request for global</span></span>
<span><span class="co"># particulate matter data, data will be stored</span></span>
<span><span class="co"># in your present working directory with filename</span></span>
<span><span class="co"># particulate_matter.nc</span></span>
<span><span class="va">request</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  date <span class="op">=</span> <span class="st">"2003-01-01/2003-01-01"</span>,</span>
<span>  format <span class="op">=</span> <span class="st">"netcdf"</span>,</span>
<span>  variable <span class="op">=</span> <span class="st">"particulate_matter_2.5um"</span>,</span>
<span>  time <span class="op">=</span> <span class="st">"00:00"</span>,</span>
<span>  dataset_short_name <span class="op">=</span> <span class="st">"cams-global-reanalysis-eac4"</span>,</span>
<span>  target <span class="op">=</span> <span class="st">"particulate_matter.nc"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># If you have stored your user login information</span></span>
<span><span class="co"># in the keyring by calling cds_set_key you can</span></span>
<span><span class="co"># call:</span></span>
<span><span class="va">file</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/wf_request.html">wf_request</a></span><span class="op">(</span></span>
<span> user     <span class="op">=</span> <span class="st">"2345"</span>,   <span class="co"># user ID (for authentification)</span></span>
<span> request  <span class="op">=</span> <span class="va">request</span>,  <span class="co"># the request</span></span>
<span> transfer <span class="op">=</span> <span class="cn">TRUE</span>,     <span class="co"># download the file</span></span>
<span> path     <span class="op">=</span> <span class="st">"."</span>       <span class="co"># store data in current working directory</span></span>
<span> <span class="op">)</span></span></code></pre></div>
<p>The same file restrictions and notes as for the CDS apply to the ADS.</p>
</div>
</div>
<div class="section level2">
<h2 id="file-based-keychains">File based keychains<a class="anchor" aria-label="anchor" href="#file-based-keychains"></a>
</h2>
<p>On linux you can opt to use a file based keyring, instead of a GUI based keyring manager. This is helpful for headless setups such as servers. For this option to work linux users must set an environmental option.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>keyring_backend<span class="op">=</span><span class="st">"file"</span><span class="op">)</span></span></code></pre></div>
<p>You will be asked to provide a password to encrypt the keyring with. Upon the start of each session you will be asked to provide this password, unlocking all <code>ecmwfr</code> credentials for this session. Should you ever forget the password just delete the file at: <code>~/.config/r-keyring/ecmwfr.keyring</code> and re-enter all your credentials.</p>
</div>
<div class="section level2">
<h2 id="date-specification">Date specification<a class="anchor" aria-label="anchor" href="#date-specification"></a>
</h2>
<p>For those familiar to ECMWF <em>mars</em> syntax: CDS/ADS does not accept <code>date = "2000-01-01/to/2000-12-31"</code> specifications. It is possible to specify one specific date via <code>date = "2000-01-01"</code> or multiple days via <code>date = ["2000-01-01","2000-01-02","2000-10-20"]</code> or <code>date = "YYYY-MM-DD/YYYY-MM-DD"</code>. Specifying the date as a range allows you to sidestep the <a href="https://confluence.ecmwf.int/pages/viewpage.action?pageId=277352608&amp;focusedCommentId=278530169" class="external-link">ERA5T restricted access issue</a>.</p>
</div>
<div class="section level2">
<h2 id="citation">Citation<a class="anchor" aria-label="anchor" href="#citation"></a>
</h2>
<p>Hufkens, K., R. Stauffer, &amp; E. Campitelli. (2019). ecmwfr: Programmatic interface to the two European Centre for Medium-Range Weather Forecasts API services. Zenodo. <a href="http://doi.org/10.5281/zenodo.2647531" class="external-link uri">http://doi.org/10.5281/zenodo.2647531</a>.</p>
</div>
<div class="section level2">
<h2 id="acknowledgements">Acknowledgements<a class="anchor" aria-label="anchor" href="#acknowledgements"></a>
</h2>
<p>This project was in part supported by the Belgian Science Policy office COBECORE project (BELSPO; grant BR/175/A3/COBECORE), a “Fonds voor Wetenschappelijk Onderzoek” travel grant (FWO; V438318N) and the Marie Skłodowska-Curie Action (H2020 grant 797668). Logo design elements are taken from the FontAwesome library according to <a href="https://fontawesome.com/license" class="external-link">these terms</a>, where the globe element was inverted and intersected.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=ecmwfr" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/bluegreen-labs/ecmwfr/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/bluegreen-labs/ecmwfr/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/AGPL-3" class="external-link">AGPL-3</a></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing ecmwfr</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://bluegreenlabs.org" class="external-link">Koen Hufkens</a> <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-5070-8109" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>
<a href="https://bluegreenlabs.org" class="external-link">BlueGreen Labs</a> <br><small class="roles"> Copyright holder, funder </small>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>



  </div>
</div>


      <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start bottom-8">
            <div class="col-xs-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="http://github.com/bluegreen-labs" target="_blank" class="external-link">
                          <div class="icon fab fa-github"></div></a>
                        <a href="https://bluegreenlabs.org/labs/" target="_blank" class="external-link">
                          <div class="icon fa fa-flask"></div></a>
                        <a href="http://twitter.com/bluegreen_labs" target="_blank" class="external-link">
                          <div class="icon fab fa-twitter"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://bluegreenlabs.org/#intro" class="external-link">BlueGreen Labs</a></li>
                            <li><a href="https://bluegreenlabs.org/#people" class="external-link">Our Team</a></li>
                            <li><a href="https://bluegreenlabs.org/#contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://github.com/bluegreen-labs" class="external-link">Packages</a></li>
                            <li><a href="https://bluegreenlabs.org/publication/" class="external-link">Publications</a></li>
                            <li><a href="https://bluegreenlabs.org/post/" class="external-link">Blog</a></li>
                        </ul>
</div>

                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->

      </footer>
</div>

  


  

  </body>
</html>
